import hancho
import os
import random

# Queues up 100 tasks that use random numbers of cores, then a "Job Hog" that uses all cores, then
# another batch of 100 tasks that use random numbers of cores.

for i in range(100):
  hancho.Task(
    desc = "I am task {index}, I use {job_count} cores",
    command = "(exit 0)",
    source_files = [],
    build_files = [],
    job_count = random.randrange(1, os.cpu_count() + 1),
    index = i
  )

hancho.Task(
  desc = "********** I am the slow task, I eat all the cores **********",
  command = [
    "touch {rel_build_files}",
    "sleep 0.3",
  ],
  job_count = os.cpu_count(),
  source_files = [],
  build_files = "slow_result.txt",
)

for i in range(100):
  hancho.Task(
    desc = "I am task {index}, I use {job_count} cores",
    command = "(exit 0)",
    source_files = [],
    build_files = [],
    job_count = random.randrange(1, os.cpu_count() + 1),
    index = 100 + i
  )
